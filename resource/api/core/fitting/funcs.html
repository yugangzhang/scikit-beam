<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>xrf_model Module &mdash; scikit-beam 0.0.6 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootswatch-3.3.4/spacelab/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.0.6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-3.3.4/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="scikit-beam 0.0.6 documentation" href="../../../../index.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../../../index.html">
          scikit-beam</a>
        <span class="navbar-text navbar-version pull-left"><b>0.0.6</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="../../../../tutorial.html">Tutorial</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../../../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../introduction.html">Introduction to scikit-beam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html">Installing scikit-beam</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../installation.html#updating-your-installation">Updating Your Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../whats_new.html">What&#8217;s new</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../index.html">Complete Reference (API)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../dev_guide/index.html">Development Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial.html">Tutorial with Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/dpc_demo.html">Differential Phase Contrast</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/speckle-plotting.html">Plotting helper functions for Speckle analysis &#8211; <code class="docutils literal"><span class="pre">xray_vision.mpl_plotting.speckle</span></code> module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/XPCS_fitting_with_lmfit.html">XPCS fitting with lmfit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/Multi_tau_one_time_correlation_example.html">One Time Correlation Example for NIPA_GEL 250K¶</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/Generate_ROI_labeled_arrays.html">Generate Region of Interests (ROI) labeled arrays for simple shapes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/recip_example.html">This is an example of using real experimental data to plot the HK plane</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/plot_xrf_spectrum.html">Using X-ray fluorescence information in scikit-xray</a></li>
</ul>
</ul>
</li>
              
                <li class="dropdown">
  <a role="button"
     id="dLabelLocalToc"
     data-toggle="dropdown"
     data-target="#"
     href="#">Page <b class="caret"></b></a>
  <ul class="dropdown-menu localtoc"
      role="menu"
      aria-labelledby="dLabelLocalToc"><ul>
<li><a class="reference internal" href="#"><code class="docutils literal"><span class="pre">xrf_model</span></code> Module</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="col-md-12 content">
      
  <div class="section" id="module-skbeam.core.fitting.xrf_model">
<span id="xrf-model-module"></span><h1><code class="xref py py-mod docutils literal"><span class="pre">xrf_model</span></code> Module<a class="headerlink" href="#module-skbeam.core.fitting.xrf_model" title="Permalink to this headline">¶</a></h1>
<dl class="class">
<dt id="skbeam.core.fitting.xrf_model.ElementModel">
<em class="property">class </em><code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">ElementModel</code><span class="sig-paren">(</span><em>*args</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ElementModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">lmfit.model.Model</span></code></p>
<p>Wrap the element_peak_xrf function for fitting within lmfit framework</p>
<p>This is a function to construct xrf element peak, which is based on
gauss profile, but more specific requirements need to be
considered. For instance, the standard deviation is replaced by
global fitting parameters, and energy calibration on x is taken into
account.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>x</strong> : array</p>
<blockquote>
<div><p>independent variable, channel number instead of energy</p>
</div></blockquote>
<p><strong>area</strong> : float</p>
<blockquote>
<div><p>area of gaussian function</p>
</div></blockquote>
<p><strong>center</strong> : float</p>
<blockquote>
<div><p>center position</p>
</div></blockquote>
<p><strong>delta_center</strong> : float</p>
<blockquote>
<div><p>adjustment to center position</p>
</div></blockquote>
<p><strong>delta_sigma</strong> : float</p>
<blockquote>
<div><p>adjustment to standard deviation</p>
</div></blockquote>
<p><strong>ratio</strong> : float</p>
<blockquote>
<div><p>branching ratio</p>
</div></blockquote>
<p><strong>ratio_adjust</strong> : float</p>
<blockquote>
<div><p>value used to adjust peak height</p>
</div></blockquote>
<p><strong>fwhm_offset</strong> : float</p>
<blockquote>
<div><p>global fitting parameter for peak width</p>
</div></blockquote>
<p><strong>fwhm_fanoprime</strong> : float</p>
<blockquote>
<div><p>global fitting parameter for peak width</p>
</div></blockquote>
<p><strong>e_offset</strong> : float</p>
<blockquote>
<div><p>offset of energy calibration</p>
</div></blockquote>
<p><strong>e_linear</strong> : float</p>
<blockquote>
<div><p>linear coefficient in energy calibration</p>
</div></blockquote>
<p><strong>e_quadratic</strong> : float</p>
<blockquote>
<div><p>quadratic coefficient in energy calibration</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">array:</p>
<blockquote class="last">
<div><p>gaussian peak profile</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="skbeam.core.fitting.xrf_model.ModelSpectrum">
<em class="property">class </em><code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">ModelSpectrum</code><span class="sig-paren">(</span><em>params</em>, <em>elemental_lines</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ModelSpectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Construct Fluorescence spectrum which includes elastic peak,
compton and element peaks.</p>
<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ModelSpectrum.assemble_models">
<code class="descname">assemble_models</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ModelSpectrum.assemble_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Put all models together to form a spectrum.</p>
</dd></dl>

<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ModelSpectrum.model_fit">
<code class="descname">model_fit</code><span class="sig-paren">(</span><em>channel_number</em>, <em>spectrum</em>, <em>weights=None</em>, <em>method='leastsq'</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ModelSpectrum.model_fit" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>channel_number</strong> : array</p>
<blockquote>
<div><p>independent variable</p>
</div></blockquote>
<p><strong>spectrum</strong> : array</p>
<blockquote>
<div><p>intensity</p>
</div></blockquote>
<p><strong>weights</strong> : array, optional</p>
<blockquote>
<div><p>weight for fitting</p>
</div></blockquote>
<p><strong>method</strong> : str</p>
<blockquote>
<div><p>default as leastsq</p>
</div></blockquote>
<p><strong>kwargs</strong> : dict</p>
<blockquote>
<div><p>fitting criteria, such as max number of iteration</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last">result object from lmfit</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ModelSpectrum.setup_compton_model">
<code class="descname">setup_compton_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ModelSpectrum.setup_compton_model" title="Permalink to this definition">¶</a></dt>
<dd><p>setup parameters related to Compton model</p>
</dd></dl>

<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ModelSpectrum.setup_elastic_model">
<code class="descname">setup_elastic_model</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ModelSpectrum.setup_elastic_model" title="Permalink to this definition">¶</a></dt>
<dd><p>setup parameters related to Elastic model</p>
</dd></dl>

<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ModelSpectrum.setup_element_model">
<code class="descname">setup_element_model</code><span class="sig-paren">(</span><em>elemental_line</em>, <em>default_area=100000.0</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ModelSpectrum.setup_element_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct element model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>elemental_line</strong> : str</p>
<blockquote>
<div><p>elemental line, such as &#8216;Fe_K&#8217;</p>
</div></blockquote>
<p><strong>default_area</strong> : float, optional</p>
<blockquote class="last">
<div><p>value for the initial area of a given element
default is 1e5, found to be a good value</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="skbeam.core.fitting.xrf_model.ParamController">
<em class="property">class </em><code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">ParamController</code><span class="sig-paren">(</span><em>params</em>, <em>elemental_lines</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ParamController" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal"><span class="pre">object</span></code></p>
<p>Update element peak information in parameter dictionary.
This is an important step in dynamical fitting.</p>
<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ParamController.add_param">
<code class="descname">add_param</code><span class="sig-paren">(</span><em>kind</em>, <em>element</em>, <em>constraint=None</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ParamController.add_param" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a Parameter controlling peak position, width,
branching ratio, or area.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>kind</strong> : {&#8216;pos&#8217;, &#8216;width&#8217;, &#8216;ratio&#8217;, &#8216;area&#8217;}</p>
<p><strong>element</strong> : str</p>
<blockquote>
<div><p>element name</p>
</div></blockquote>
<p><strong>constraint</strong> : {&#8216;lo&#8217;, &#8216;hi&#8217;, &#8216;lohi&#8217;, &#8216;fixed&#8217;, &#8216;none&#8217;}, optional</p>
<blockquote class="last">
<div><p>default &#8220;bound strategy&#8221; (fitting constraints)</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ParamController.set_strategy">
<code class="descname">set_strategy</code><span class="sig-paren">(</span><em>strategy_name</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ParamController.set_strategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the default value of bounds.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>strategy_name</strong> : str</p>
<blockquote class="last">
<div><p>fitting strategy that this Model will use</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="skbeam.core.fitting.xrf_model.ParamController.update_element_prop">
<code class="descname">update_element_prop</code><span class="sig-paren">(</span><em>element_list</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.ParamController.update_element_prop" title="Permalink to this definition">¶</a></dt>
<dd><p>Update element properties, such as pos, width, area and ratio.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>element_list</strong> : list</p>
<blockquote>
<div><p>define which element to update</p>
</div></blockquote>
<p><strong>kwargs</strong> : dict</p>
<blockquote>
<div><p>define what kind of property to change</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><strong>dict</strong> : updated value</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.calculate_area">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">calculate_area</code><span class="sig-paren">(</span><em>e_select</em>, <em>matv</em>, <em>results</em>, <em>param</em>, <em>first_peak_area=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.calculate_area" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>e_select</strong> : list</p>
<blockquote>
<div><p>elements</p>
</div></blockquote>
<p><strong>matv</strong> : 2D array</p>
<blockquote>
<div><p>matrix constains elemental profile as columns</p>
</div></blockquote>
<p><strong>results</strong> : 3D array</p>
<blockquote>
<div><p>x, y positions, and each element&#8217;s weight on third dim</p>
</div></blockquote>
<p><strong>param</strong> : dict</p>
<blockquote>
<div><p>parameters of fitting</p>
</div></blockquote>
<p><strong>first_peak_area</strong> : Bool, optional</p>
<blockquote>
<div><p>get overal peak area or only the first peak area, such as Ar_Ka1</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">dict :</p>
<blockquote class="last">
<div><p>dict of each 2D elemental distribution</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.compute_escape_peak">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">compute_escape_peak</code><span class="sig-paren">(</span><em>spectrum</em>, <em>ratio</em>, <em>params</em>, <em>escape_e=1.73998</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.compute_escape_peak" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate the escape peak for given detector.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>spectrum</strong> : array</p>
<blockquote>
<div><p>original, uncorrected spectrum</p>
</div></blockquote>
<p><strong>ratio</strong> : float</p>
<blockquote>
<div><p>ratio of shadow to full spectrum</p>
</div></blockquote>
<p><strong>param</strong> : dict</p>
<blockquote>
<div><p>fitting parameters</p>
</div></blockquote>
<p><strong>escape_e</strong> : float</p>
<blockquote>
<div><p>Units: keV
By default, 1.73998 (Ka1 line of Si)</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">array:</p>
<blockquote class="last">
<div><p>x after shift, and adjusted y</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.construct_linear_model">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">construct_linear_model</code><span class="sig-paren">(</span><em>channel_number</em>, <em>params</em>, <em>elemental_lines</em>, <em>default_area=100</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.construct_linear_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Create spectrum with parameters given from params.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>channel_number</strong> : array</p>
<blockquote>
<div><p>N.B. This is the raw independent variable, not energy.</p>
</div></blockquote>
<p><strong>params</strong> : dict</p>
<blockquote>
<div><p>fitting parameters</p>
</div></blockquote>
<p><strong>elemental_lines</strong> : list</p>
<blockquote>
<div><p>e.g., [&#8216;Na_K&#8217;, Mg_K&#8217;, &#8216;Pt_M&#8217;] refers to the
K lines of Sodium, the K lines of Magnesium, and the M
lines of Platinum</p>
</div></blockquote>
<p><strong>default_area</strong> : float</p>
<blockquote>
<div><p>value for the initial area of a given element</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>selected_elements</strong> : list</p>
<blockquote>
<div><p>selected elements for given energy</p>
</div></blockquote>
<p><strong>matv</strong> : array</p>
<blockquote>
<div><p>matrix for linear fitting</p>
</div></blockquote>
<p><strong>element_area</strong> : dict</p>
<blockquote class="last">
<div><p>area of the given elements</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.element_peak_xrf">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">element_peak_xrf</code><span class="sig-paren">(</span><em>x</em>, <em>area</em>, <em>center</em>, <em>delta_center</em>, <em>delta_sigma</em>, <em>ratio</em>, <em>ratio_adjust</em>, <em>fwhm_offset</em>, <em>fwhm_fanoprime</em>, <em>e_offset</em>, <em>e_linear</em>, <em>e_quadratic</em>, <em>epsilon=2.96</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.element_peak_xrf" title="Permalink to this definition">¶</a></dt>
<dd><p>This is a function to construct xrf element peak, which is based on
gauss profile, but more specific requirements need to be
considered. For instance, the standard deviation is replaced by
global fitting parameters, and energy calibration on x is taken into
account.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>x</strong> : array</p>
<blockquote>
<div><p>independent variable, channel number instead of energy</p>
</div></blockquote>
<p><strong>area</strong> : float</p>
<blockquote>
<div><p>area of gaussian function</p>
</div></blockquote>
<p><strong>center</strong> : float</p>
<blockquote>
<div><p>center position</p>
</div></blockquote>
<p><strong>delta_center</strong> : float</p>
<blockquote>
<div><p>adjustment to center position</p>
</div></blockquote>
<p><strong>delta_sigma</strong> : float</p>
<blockquote>
<div><p>adjustment to standard deviation</p>
</div></blockquote>
<p><strong>ratio</strong> : float</p>
<blockquote>
<div><p>branching ratio</p>
</div></blockquote>
<p><strong>ratio_adjust</strong> : float</p>
<blockquote>
<div><p>value used to adjust peak height</p>
</div></blockquote>
<p><strong>fwhm_offset</strong> : float</p>
<blockquote>
<div><p>global fitting parameter for peak width</p>
</div></blockquote>
<p><strong>fwhm_fanoprime</strong> : float</p>
<blockquote>
<div><p>global fitting parameter for peak width</p>
</div></blockquote>
<p><strong>e_offset</strong> : float</p>
<blockquote>
<div><p>offset of energy calibration</p>
</div></blockquote>
<p><strong>e_linear</strong> : float</p>
<blockquote>
<div><p>linear coefficient in energy calibration</p>
</div></blockquote>
<p><strong>e_quadratic</strong> : float</p>
<blockquote>
<div><p>quadratic coefficient in energy calibration</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">array:</p>
<blockquote class="last">
<div><p>gaussian peak profile</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.fit_per_line_nnls">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">fit_per_line_nnls</code><span class="sig-paren">(</span><em>data</em>, <em>matv</em>, <em>param</em>, <em>use_snip</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.fit_per_line_nnls" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit experiment data for a given row using nnls algorithm.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>data</strong> : array</p>
<blockquote>
<div><p>selected one row of experiment spectrum</p>
</div></blockquote>
<p><strong>matv</strong> : array</p>
<blockquote>
<div><p>matrix for regression analysis</p>
</div></blockquote>
<p><strong>param</strong> : dict</p>
<blockquote>
<div><p>fitting parameters</p>
</div></blockquote>
<p><strong>use_snip</strong> : bool</p>
<blockquote>
<div><p>use snip algorithm to remove background or not</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">array :</p>
<blockquote class="last">
<div><p>fitting values for all the elements at a given row. Background is
calculated as a summed value. Also residual is included.</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.fit_pixel_multiprocess_nnls">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">fit_pixel_multiprocess_nnls</code><span class="sig-paren">(</span><em>exp_data</em>, <em>matv</em>, <em>param</em>, <em>use_snip=False</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.fit_pixel_multiprocess_nnls" title="Permalink to this definition">¶</a></dt>
<dd><p>Multiprocess fit of experiment data.
Parameters
&#8212;&#8212;&#8212;-
exp_data : array</p>
<blockquote>
<div>3D data of experiment spectrum,
with x,y positions as the first 2-dim, and energy as the third one.</div></blockquote>
<dl class="docutils">
<dt>matv <span class="classifier-delimiter">:</span> <span class="classifier">array</span></dt>
<dd>matrix for regression analysis</dd>
<dt>param <span class="classifier-delimiter">:</span> <span class="classifier">dict</span></dt>
<dd>fitting parameters</dd>
<dt>use_snip <span class="classifier-delimiter">:</span> <span class="classifier">bool, optional</span></dt>
<dd>use snip algorithm to remove background or not</dd>
</dl>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">array</p>
<blockquote class="last">
<div><p>Fitting values for all the elements</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.get_activated_lines">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">get_activated_lines</code><span class="sig-paren">(</span><em>incident_energy</em>, <em>elemental_lines</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.get_activated_lines" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>incident_energy</strong> : float</p>
<blockquote>
<div><p>beam energy</p>
</div></blockquote>
<p><strong>element_lines</strong> : list</p>
<blockquote>
<div><p>e.g., [&#8216;Na_K&#8217;, &#8216;Mg_K&#8217;, &#8216;Pt_M&#8217;]</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">list</p>
<blockquote class="last">
<div><p>all activated lines for given elements</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.get_line_energy">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">get_line_energy</code><span class="sig-paren">(</span><em>elemental_line</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.get_line_energy" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the energy of the first line in K, L or M series.
Parameters
&#8212;&#8212;&#8212;-
elemental_line : str</p>
<blockquote>
<div>For instance, Eu_L is the format for L lines and Pt_M for M lines.
And for K lines, user needs to define lines like ka1, kb1,
because for K lines, we consider contributions from either ka1
or kb1, while for L or M lines, we only consider the primary peak.</div></blockquote>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">float :</p>
<blockquote class="last">
<div><p>energy of emission line</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.get_relative_cs_ratio">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">get_relative_cs_ratio</code><span class="sig-paren">(</span><em>elemental_line</em>, <em>energy</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.get_relative_cs_ratio" title="Permalink to this definition">¶</a></dt>
<dd><p>At given energy, multiple elemental lines may be activated. This function is
used to calculate the ratio of the first line&#8217;s cross section (cs) to
the summed cross section from all the lines.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>elemental_line</strong> : str</p>
<blockquote>
<div><p>e.g., &#8216;Mg_K&#8217;, refers to the K lines of Magnesium</p>
</div></blockquote>
<p><strong>energy</strong> : float</p>
<blockquote>
<div><p>incident energy in keV</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">float :</p>
<blockquote class="last">
<div><p>calculated ratio</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.linear_spectrum_fitting">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">linear_spectrum_fitting</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>params</em>, <em>elemental_lines=None</em>, <em>weights=None</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.linear_spectrum_fitting" title="Permalink to this definition">¶</a></dt>
<dd><p>Fit a spectrum to a linear model.</p>
<p>This is a convenience function that wraps up construct_linear_model
and nnls_fit.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>x</strong> : array</p>
<blockquote>
<div><p>channel array</p>
</div></blockquote>
<p><strong>y</strong> : array</p>
<blockquote>
<div><p>spectrum intensity</p>
</div></blockquote>
<p><strong>param</strong> : dict</p>
<blockquote>
<div><p>fitting parameters</p>
</div></blockquote>
<p><strong>elemental_lines</strong> : list, optional</p>
<blockquote>
<div><p>e.g., [&#8216;Na_K&#8217;, Mg_K&#8217;, &#8216;Pt_M&#8217;] refers to the
K lines of Sodium, the K lines of Magnesium, and the M
lines of Platinum. If elemental_lines is set as None,
all the possible lines activated at given energy will be used.</p>
</div></blockquote>
<p><strong>weights</strong> : array, optional</p>
<blockquote>
<div><p>for weighted nnls fitting. Setting weights as None means fitting
without weights.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>x_energy</strong> : array</p>
<blockquote>
<div><p>x axis with unit in energy</p>
</div></blockquote>
<p><strong>result_dict</strong> : dict</p>
<blockquote>
<div><p>Fitting results</p>
</div></blockquote>
<p><strong>area_dict</strong> : dict</p>
<blockquote class="last">
<div><p>the area of the first main peak, such as Ka1, of a given element</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.nnls_fit">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">nnls_fit</code><span class="sig-paren">(</span><em>spectrum</em>, <em>expected_matrix</em>, <em>weights=None</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.nnls_fit" title="Permalink to this definition">¶</a></dt>
<dd><p>Non-negative least squares fitting.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>spectrum</strong> : array</p>
<blockquote>
<div><p>spectrum of experiment data</p>
</div></blockquote>
<p><strong>expected_matrix</strong> : array</p>
<blockquote>
<div><p>2D matrix of activated element spectrum</p>
</div></blockquote>
<p><strong>weights</strong> : array, optional</p>
<blockquote>
<div><p>for weighted nnls fitting. Setting weights as None means fitting
without weights.</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>results</strong> : array</p>
<blockquote>
<div><p>weights of different element</p>
</div></blockquote>
<p><strong>residue</strong> : float</p>
<blockquote class="last">
<div><p>error</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.register_strategy">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">register_strategy</code><span class="sig-paren">(</span><em>key</em>, <em>strategy</em>, <em>overwrite=True</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.register_strategy" title="Permalink to this definition">¶</a></dt>
<dd><p>Register new strategy.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>key</strong> : str</p>
<blockquote>
<div><p>strategy name</p>
</div></blockquote>
<p><strong>strategy</strong> : dict</p>
<blockquote class="last">
<div><p>bound for every parameter</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.set_parameter_bound">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">set_parameter_bound</code><span class="sig-paren">(</span><em>param</em>, <em>bound_option</em>, <em>extra_config=None</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.set_parameter_bound" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the default value of bounds.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This function mutates the input values.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>param</strong> : dict</p>
<blockquote>
<div><p>saving all the fitting values and their bounds</p>
</div></blockquote>
<p><strong>bound_option</strong> : str</p>
<blockquote>
<div><p>define bound type</p>
</div></blockquote>
<p><strong>extra_config</strong> : dict</p>
<blockquote class="last">
<div><p>strategy-specific configuration</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.sum_area">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">sum_area</code><span class="sig-paren">(</span><em>elemental_line</em>, <em>result_val</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.sum_area" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the total area for given element.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>elemental_line</strong> : str</p>
<blockquote>
<div><p>name of a given element line, such as Na_K</p>
</div></blockquote>
<p><strong>result_val</strong> : obj</p>
<blockquote>
<div><p>result obj from lmfit to save all the fitting results</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first"><strong>sumv</strong> : float</p>
<blockquote class="last">
<div><p>the total area</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.trim">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">trim</code><span class="sig-paren">(</span><em>x</em>, <em>y</em>, <em>low</em>, <em>high</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.trim" title="Permalink to this definition">¶</a></dt>
<dd><p>Mask two arrays applying bounds to the first array.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>x</strong> : array</p>
<blockquote>
<div><p>independent variable</p>
</div></blockquote>
<p><strong>y</strong> : array</p>
<blockquote>
<div><p>dependent variable</p>
</div></blockquote>
<p><strong>low</strong> : float</p>
<blockquote>
<div><p>low bound</p>
</div></blockquote>
<p><strong>high</strong> : float</p>
<blockquote>
<div><p>high bound</p>
</div></blockquote>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first">array :</p>
<blockquote>
<div><p>x with new range</p>
</div></blockquote>
<p>array :</p>
<blockquote class="last">
<div><p>y with new range</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="skbeam.core.fitting.xrf_model.update_parameter_dict">
<code class="descclassname">skbeam.core.fitting.xrf_model.</code><code class="descname">update_parameter_dict</code><span class="sig-paren">(</span><em>param</em>, <em>fit_results</em><span class="sig-paren">)</span><a class="headerlink" href="#skbeam.core.fitting.xrf_model.update_parameter_dict" title="Permalink to this definition">¶</a></dt>
<dd><p>Update fitting parameters dictionary according to given fitting results,
usually obtained from previous run.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This function mutates param.</p>
</div>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><p class="first"><strong>param</strong> : dict</p>
<blockquote>
<div><p>saving all the fitting values and their bounds</p>
</div></blockquote>
<p><strong>fit_results</strong> : object</p>
<blockquote class="last">
<div><p>ModelFit object from lmfit</p>
</div></blockquote>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
        <br/>
        
<div id="sourcelink">
  <a href="../../../../_sources/resource/api/core/fitting/funcs.txt"
     rel="nofollow">Source</a>
</div>
      
    </p>
    <p>
        &copy; Copyright 2014-2015 Brookhaven National Lab.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>